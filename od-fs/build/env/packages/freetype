#!/bin/sh
# --------------------------------------------------------------------------------------------------
set -e
# --------------------------------------------------------------------------------------------------

"$BUILD_ENV_DIR/packages/harfbuzz"
"$BUILD_ENV_DIR/packages/libpng"
"$BUILD_ENV_DIR/packages/zlib"

PACKAGE=freetype-2.13.3
PACKAGE_REVISION=0
CHECKSUM=0550350666d427c74daeb85d5ac7bb353acba5f76956395995311a9c6f063289

# --------------------------------------------------------------------------------------------------
. "$PACKAGE_PRE"
# --------------------------------------------------------------------------------------------------

"$BUILD_ENV_DIR/scripts/download.py" \
https://download.savannah.gnu.org/releases/freetype/freetype-2.13.3.tar.xz \
sha256:$CHECKSUM

tar xf "$BUILD_ENV_DIR/_sources/freetype-2.13.3.tar.xz"
cd freetype-2.13.3

./configure --prefix=$PREFIX \
--without-brotli \
--without-bzip2 \
--with-harfbuzz \
--with-png \
--with-zlib
if [ "$SYSTEM_OS" = "Windows" ]; then
make PLATFORM=windows
else
make
fi
make install

# if [ "$SYSTEM_OS" = "macOS" ]; then
# DYLIB=libfreetype.6.dylib
# install_name_tool -id @rpath/$DYLIB $PREFIX/lib/$DYLIB
# fi

# --------------------------------------------------------------------------------------------------
. "$PACKAGE_POST"
# --------------------------------------------------------------------------------------------------
