#!/bin/sh
# --------------------------------------------------------------------------------------------------
set -e
# --------------------------------------------------------------------------------------------------

"$BUILD_ENV_DIR/packages/libpng"
"$BUILD_ENV_DIR/packages/sdl3"

PACKAGE=SDL3_image-3.2.4
PACKAGE_REVISION=0
CHECKSUM=a725bd6d04261fdda0dd8d950659e1dc15a8065d025275ef460d32ae7dcfc182

# --------------------------------------------------------------------------------------------------
. "$PACKAGE_PRE"
# --------------------------------------------------------------------------------------------------

"$BUILD_ENV_DIR/scripts/download.py" \
https://www.libsdl.org/projects/SDL_image/release/$PACKAGE.tar.gz \
sha256:$CHECKSUM

tar xf "$BUILD_ENV_DIR/_sources/$PACKAGE.tar.gz"
cd $PACKAGE

cmake \
-DSDLIMAGE_AVIF=OFF \
-DSDLIMAGE_BMP=OFF \
-DSDLIMAGE_GIF=OFF \
-DSDLIMAGE_JXL=OFF \
-DSDLIMAGE_LBM=OFF \
-DSDLIMAGE_PCX=OFF \
-DSDLIMAGE_PNM=OFF \
-DSDLIMAGE_QOI=OFF \
-DSDLIMAGE_SVG=OFF \
-DSDLIMAGE_TGA=OFF \
-DSDLIMAGE_TIF=OFF \
-DSDLIMAGE_WEBP=OFF \
-DSDLIMAGE_XCF=OFF \
-DSDLIMAGE_XPM=OFF \
-DSDLIMAGE_XV=OFF \
-S . -B _build
cmake --build _build
cmake --install _build --prefix $PREFIX

if [ "$SYSTEM_OS" = "macOS" ]; then
DYLIB=libSDL3_image.0.dylib
install_name_tool -id $PREFIX/lib/$DYLIB $PREFIX/lib/$DYLIB
fi

# --------------------------------------------------------------------------------------------------
. "$PACKAGE_POST"
# --------------------------------------------------------------------------------------------------
