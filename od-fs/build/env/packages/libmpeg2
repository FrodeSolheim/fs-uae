#!/bin/sh
# This file is automatically generated by fs-package
set -e

PACKAGE=libmpeg2-0.5.1
CHECKSUM=dee22e893cb5fc2b2b6ebd60b88478ab8556cb3b93f9a0d7ce8f3b61851871d4
REVISION=0

. "$BUILD_ENV_DIR/scripts/package.sh"

"$BUILD_ENV_DIR/scripts/download.py" \
http://fs-uae.net/files/libmpeg2-0.5.1.tar.gz \
sha256:$CHECKSUM

tar xf "$BUILD_ENV_DIR/_sources/$PACKAGE.tar.gz"
cd $PACKAGE

if [ "$SYSTEM_ARCH" = "ARM64" ]; then
# Requires more up2date config.sub to detect platform
automake --add-missing --copy --force-missing || true
fi

# Using -std=gnu89 to avoid some inline problems causing linker errors
./configure --prefix=$PREFIX CFLAGS="-std=gnu89 -O2"
cd libmpeg2
make
cd ..
# Make libmpeg2.a build deterministically by sorting objects
mkdir temp
cd temp
ar x ../libmpeg2/.libs/libmpeg2.a
ar cru libmpeg2.a `ls *.o | sort`
ranlib libmpeg2.a
mv libmpeg2.a ../libmpeg2/.libs/libmpeg2.a
cd ..
cd libmpeg2
make install
cd ../include
make install

touch $INSTALLED
